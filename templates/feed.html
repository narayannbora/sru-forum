{% extends "layout.html" %}
{% block content %}
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 15px;">
        <div>
            <h1 style="margin-bottom: 5px; font-size: 1.8rem; letter-spacing: -0.5px; color: var(--text-main);">{{ title }}</h1>
            <p style="color: var(--text-sub); margin: 0; font-size: 0.95rem;">
                {% if page_type == 'market' %}Buy, sell, and find lost items.{% elif page_type == 'skill' %}Connect with peer tutors and seekers.{% else %}Campus discussions and general posts.{% endif %}
            </p>
        </div>
        
        <a href="{{ url_for('new_post', category=page_type) }}" class="btn-signup" style="text-decoration: none;">
            + Post to {{ page_type|capitalize }}
        </a>
    </div>

    {% if posts|length == 0 %}
        <div class="card" style="text-align: center; padding: 60px; color: var(--text-sub); border: 2px dashed var(--border);">
            <h3>It's quiet here... ü¶ó</h3>
            <p>Be the first to post in the <strong>{{ page_type|capitalize }}</strong> section!</p>
        </div>
    {% else %}
        
        <div style="display: flex; flex-direction: column; gap: 15px;">

        {% for post in posts %}

        {% set border_color = '#9333ea' %}
        {% if post.category == 'market' %}{% set border_color = '#46D160' %}
        {% elif post.category == 'lost' %}{% set border_color = '#FF8717' %}
        {% elif post.category == 'skill' %}{% set border_color = '#0079D3' %}{% endif %}

        <div class="card" style="padding: 20px; border-left: 4px solid {{ border_color }};">
            
            <div class="post-body-wrapper">
                
                <h3 style="margin: 0 0 4px 0; font-size: 1.2rem; color: var(--text-main);">
                    {# LINK FIX: Make the title link to the detail page #}
                    <a href="{{ url_for('post_detail', post_id=post.id) }}" style="color: inherit; text-decoration: none;">
                        {{ post.title }}
                    </a>
                    {% if post.price and post.category != 'lost' %}<span style="color: {{ border_color }}; margin-left: 10px; font-size: 0.9em;">(‚Çπ{{ post.price }})</span>{% endif %}
                </h3>
                
                <p style="font-size: 0.85rem; color: var(--text-sub); margin: 0 0 10px 0;">
                    Posted by u/<strong>{{ post.author.username }}</strong> on {{ post.date_posted.strftime('%b %d, %Y') }}
                    <span style="background: var(--bg-input); padding: 2px 6px; border-radius: 4px; margin-left: 10px; text-transform: uppercase;">{{ post.category }}</span>
                </p>

                <p style="font-size: 0.95rem; color: var(--text-main); margin-bottom: 15px; white-space: pre-wrap;">
                    {{ post.content | truncate(250) }} 
                </p>

                <div class="post-action-bar" style="border-top: 1px solid var(--border); padding-top: 10px; display: flex; gap: 20px;">
                    
                    {# LINK FIX: Update 'View Discussion' link #}
                    <a href="{{ url_for('post_detail', post_id=post.id) }}" style="color: var(--primary); font-weight: 600; text-decoration: none; font-size: 0.9rem;">
                        <span style="font-size: 1.1em; vertical-align: middle;">üí¨</span> View Discussion
                    </a>
                    
                    {% if post.author == current_user %}
                        <form action="{{ url_for('delete_post', post_id=post.id) }}" method="POST" style="margin: 0;">
                            <button type="submit" style="background: none; border: none; color: var(--danger); font-size: 0.9rem; cursor: pointer; padding: 0; font-weight: 600;">üóëÔ∏è Delete Post</button>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>

        {% endfor %}
        
        </div>
    {% endif %}

{% endblock %}